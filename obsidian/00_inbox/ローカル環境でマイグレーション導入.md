
## 目的


## 前提
- Maven導入済みのjavaプロジェクト



## 具体的な手順

### 1. pom.xmlの更新

依存関係セクション
```
org.flywaydb flyway-database-postgresql 9.22.3
```

プラグインセクション
```
<plugin>  
    <groupId>org.flywaydb</groupId>  
    <artifactId>flyway-maven-plugin</artifactId>  
    <version>9.22.3</version>  
    <configuration>        <url>jdbc:postgresql://localhost:5432/your_database_name</url>  
        <user>your_db_user</user>  
        <password>your_db_password</password>  
        <locations>            <location>filesystem:src/main/resources/db/migration</location>  
        </locations>  
        <baselineOnMigrate>true</baselineOnMigrate>  
    </configuration>  
</plugin>
```


### 2. マイグレーション用ディレクトリを作成

```
mkdir -p src/main/resources/db/migration
```




### 3.既存SQLファイルをマイグレーション形式に変換

すでにプロジェクトに配置されていたSQLファイルをFlywayの命名規則に従って配置する

>ルール：
V：必ず大文字のVで始める
バージョン番号：1, 1.1, 1.2.3などの数字（実行順序を決める）
__：アンダースコア2つ（区切り文字）
説明文：任意の説明（英数字とアンダースコア）
.sql：拡張子ルール：
V：必ず大文字のVで始める
バージョン番号：1, 1.1, 1.2.3などの数字（実行順序を決める）
__：アンダースコア2つ（区切り文字）
説明文：任意の説明（英数字とアンダースコア）
.sql：拡張子


### 4. Mavenで依存関係をダウンロード

以前のビルド結果を削除し、依存関係をダウンロードして、プロジェクトをビルドすればOK

```
cd /Users/kojimaryoutarou/flowork  
mvn clean install
```



### よく使うコマンド

マイグレーション情報の確認
```
mvn flyway:info

```


マイグレーションの実行
```
mvn flyway:migrate

```

マイグレーション履歴の確認
```
mvn flyway:info
```


ベースライン設定（既存DBに導入する場合）
```
mvn flyway:baseline

```


データベースのクリーン（開発環境のみ！）
```
mvn flyway:clean
```




### 新しいマイグレーションを追加する方法

### 1. 新しいSQLファイルを作成
バージョン番号を増やす。

```
V6__add_new_column.sql

```

### 2. SQLの内容を記述
```
ALTER TABLE users ADD COLUMN email VARCHAR(255);
```

### 3. マイグレーション実行
```
mvn flyway:migrate

```

